{% extends "base.html" %}

{% block title %}Design Color Variant Generator - Home{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">Transform Your Designs with AI</h1>
        <p class="hero-subtitle">Upload your design image and instantly generate color variants. Change blue to red, beige to navy blue, and more!</p>
        <div class="hero-features">
            <div class="feature">
                <i class="fas fa-magic"></i>
                <span>AI-Powered Color Replacement</span>
            </div>
            <div class="feature">
                <i class="fas fa-download"></i>
                <span>Instant Download</span>
            </div>
            <div class="feature">
                <i class="fas fa-palette"></i>
                <span>Multiple Color Options</span>
            </div>
        </div>
    </div>
</div>

<div class="upload-section">
    <div class="container">
        <div class="upload-card">
            <div class="upload-header">
                <h2>Upload Your Design</h2>
                <p>Supported formats: PNG, JPG, JPEG, GIF, BMP, TIFF</p>
            </div>
            
            <form id="uploadForm" enctype="multipart/form-data" class="upload-form">
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <h3>Drag & Drop your image here</h3>
                        <p>or <span class="upload-link">browse files</span></p>
                    </div>
                    <input type="file" id="fileInput" name="file" accept="image/png,image/jpeg,image/jpg,image/gif,image/bmp,image/tiff" style="display: none;">
                </div>
                
                <div class="color-options">
                    <h3>Color Replacement Options</h3>
                    <div class="color-replacement-container">
                        <div class="color-replacement-item">
                            <div class="color-input-group">
                                <label class="color-label">From Color:</label>
                                <div class="color-input-wrapper">
                                    <input type="color" id="fromColor" name="from_color" value="#1a237e" class="color-input">
                                    <span class="color-preview" id="fromColorPreview" style="background-color: #1a237e;"></span>
                                    <input type="text" id="fromColorHex" name="from_color_hex" value="#1a237e" class="color-hex-input" placeholder="#1a237e">
                                </div>
                            </div>
                            <div class="arrow-icon">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                            <div class="color-input-group">
                                <label class="color-label">To Color:</label>
                                <div class="color-input-wrapper">
                                    <input type="color" id="toColor" name="to_color" value="#d32f2f" class="color-input">
                                    <span class="color-preview" id="toColorPreview" style="background-color: #d32f2f;"></span>
                                    <input type="text" id="toColorHex" name="to_color_hex" value="#d32f2f" class="color-hex-input" placeholder="#d32f2f">
                                </div>
                            </div>
                        </div>
                        
                        <div class="color-tolerance">
                            <label for="tolerance">Color Tolerance:</label>
                            <input type="range" id="tolerance" name="tolerance" min="10" max="100" value="30" class="tolerance-slider">
                            <span id="toleranceValue">30</span>
                        </div>
                        
                        <div class="preset-buttons">
                            <button type="button" class="preset-btn" data-from="#1a237e" data-to="#d32f2f">Blue → Red</button>
                            <button type="button" class="preset-btn" data-from="#d4af37" data-to="#000080">Beige → Navy</button>
                            <button type="button" class="preset-btn" data-from="#000000" data-to="#ffffff">Black → White</button>
                            <button type="button" class="preset-btn" data-from="#ffffff" data-to="#000000">White → Black</button>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="process-btn" id="processBtn" disabled>
                    <i class="fas fa-magic"></i>
                    <span>Generate Color Variant</span>
                </button>
            </form>
        </div>
    </div>
</div>

<div class="result-section" id="resultSection" style="display: none;">
    <div class="container">
        <div class="result-card">
            <div class="result-header">
                <h2>Your Color Variant</h2>
                <button class="download-btn" id="downloadBtn">
                    <i class="fas fa-download"></i>
                    Download
                </button>
            </div>
            <div class="result-content">
                <div class="image-comparison">
                    <div class="image-container">
                        <h3>Original</h3>
                        <div class="image-wrapper">
                            <img id="originalImage" src="" alt="Original Image">
                        </div>
                    </div>
                    <div class="image-container">
                        <h3>Color Variant</h3>
                        <div class="image-wrapper">
                            <img id="processedImage" src="" alt="Processed Image">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="features-section">
    <div class="container">
        <h2 class="section-title">How It Works</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-upload"></i>
                </div>
                <h3>1. Upload</h3>
                <p>Upload your design image in any supported format. Our AI will analyze the colors automatically.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-cogs"></i>
                </div>
                <h3>2. Configure</h3>
                <p>Choose which colors to replace. Select from blue to red, beige to navy blue, or customize your own.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-magic"></i>
                </div>
                <h3>3. Generate</h3>
                <p>Our advanced AI processes your image and creates a perfect color variant while preserving all details.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3>4. Download</h3>
                <p>Download your transformed design instantly. High-quality output ready for any use case.</p>
            </div>
        </div>
    </div>
</div>

<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-content">
        <div class="spinner"></div>
        <h3>Processing Your Image</h3>
        <p>Our AI is analyzing colors and creating your variant...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('fileInput');
    const fileUploadArea = document.getElementById('fileUploadArea');
    const uploadForm = document.getElementById('uploadForm');
    const processBtn = document.getElementById('processBtn');
    const resultSection = document.getElementById('resultSection');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const originalImage = document.getElementById('originalImage');
    const processedImage = document.getElementById('processedImage');
    const downloadBtn = document.getElementById('downloadBtn');
    
    let downloadUrl = '';

    // File upload handling
    fileUploadArea.addEventListener('click', () => fileInput.click());
    fileUploadArea.addEventListener('dragover', handleDragOver);
    fileUploadArea.addEventListener('dragleave', handleDragLeave);
    fileUploadArea.addEventListener('drop', handleDrop);
    fileInput.addEventListener('change', handleFileSelect);

    function handleDragOver(e) {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
    }

    function handleDragLeave(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
    }

    function handleDrop(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect();
        }
    }

    function handleFileSelect() {
        const file = fileInput.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                originalImage.src = e.target.result;
                processBtn.disabled = false;
                fileUploadArea.classList.add('file-selected');
            };
            reader.readAsDataURL(file);
        }
    }

    // Color picker functionality
    const fromColorInput = document.getElementById('fromColor');
    const toColorInput = document.getElementById('toColor');
    const fromColorHex = document.getElementById('fromColorHex');
    const toColorHex = document.getElementById('toColorHex');
    const fromColorPreview = document.getElementById('fromColorPreview');
    const toColorPreview = document.getElementById('toColorPreview');
    const toleranceSlider = document.getElementById('tolerance');
    const toleranceValue = document.getElementById('toleranceValue');
    const presetButtons = document.querySelectorAll('.preset-btn');

    // Sync color picker with hex input
    fromColorInput.addEventListener('input', function() {
        fromColorHex.value = this.value;
        fromColorPreview.style.backgroundColor = this.value;
    });

    toColorInput.addEventListener('input', function() {
        toColorHex.value = this.value;
        toColorPreview.style.backgroundColor = this.value;
    });

    // Sync hex input with color picker
    fromColorHex.addEventListener('input', function() {
        if (this.value.match(/^#[0-9A-F]{6}$/i)) {
            fromColorInput.value = this.value;
            fromColorPreview.style.backgroundColor = this.value;
        }
    });

    toColorHex.addEventListener('input', function() {
        if (this.value.match(/^#[0-9A-F]{6}$/i)) {
            toColorInput.value = this.value;
            toColorPreview.style.backgroundColor = this.value;
        }
    });

    // Tolerance slider
    toleranceSlider.addEventListener('input', function() {
        toleranceValue.textContent = this.value;
    });

    // Preset buttons
    presetButtons.forEach(button => {
        button.addEventListener('click', function() {
            const fromColor = this.getAttribute('data-from');
            const toColor = this.getAttribute('data-to');
            
            fromColorInput.value = fromColor;
            fromColorHex.value = fromColor;
            fromColorPreview.style.backgroundColor = fromColor;
            
            toColorInput.value = toColor;
            toColorHex.value = toColor;
            toColorPreview.style.backgroundColor = toColor;
        });
    });

    // Form submission
    uploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(uploadForm);
        const file = fileInput.files[0];
        
        if (!file) {
            alert('Please select a file first');
            return;
        }

        // Validate colors
        const fromColor = fromColorHex.value;
        const toColor = toColorHex.value;
        
        if (!fromColor.match(/^#[0-9A-F]{6}$/i) || !toColor.match(/^#[0-9A-F]{6}$/i)) {
            alert('Please enter valid hex colors (e.g., #ff0000)');
            return;
        }

        loadingOverlay.style.display = 'flex';
        
        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            
            if (result.success) {
                processedImage.src = 'data:image/png;base64,' + result.image_data;
                downloadUrl = result.download_url;
                resultSection.style.display = 'block';
                resultSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Error: ' + result.error);
            }
        } catch (error) {
            alert('Error processing image: ' + error.message);
        } finally {
            loadingOverlay.style.display = 'none';
        }
    });

    // Download functionality
    downloadBtn.addEventListener('click', function() {
        if (downloadUrl) {
            window.open(downloadUrl, '_blank');
        }
    });
});
</script>
{% endblock %}
